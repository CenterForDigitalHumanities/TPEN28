<!DOCTYPE html>
<!--
Open the project management section for a given project ID.
-->
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <title>Project Management</title>
        <link type="text/css" href="css/custom-theme/jQuery.css" rel="Stylesheet" />
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.js"></script>
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.js"></script> 
        <script type="text/javascript" src="js/newberry.js"></script>
        <link rel="stylesheet" href="css/newberryTransSkin.css" type="text/css">
        <style type="text/css" >
            
            #folioManagement{
                display: none;
                position: absolute;
                top:100px;
                z-index: 1000;
                background: url("images/ui-bg_dots-medium_75_ffebb9_4x4.png") repeat scroll 50% 50% #FFEBB9;
                padding:8px;
                box-shadow: 1px 1px 1px 1px;
                width: 60%;
            }
            #projectMetadataWrapper{
                position: fixed;
                z-index: 3;
                top: 100px;
                left: 0;
                right: 0;
                max-width: 80%;
                margin: 0 auto;
                display: none;
                border: 2px solid #002a5c;
            }
            #projectUserManagement{
                position: fixed;
                z-index: 3;
                top: 100px;
                left: 0;
                right: 0;
                max-width: 80%;
                margin: 0 auto;
                display: none;
                border: 2px solid #002a5c;
                background-color: white;
                padding: 0px 12px;
                color: #002a5c;
            }
            
            #newProjectMetadata{
                margin-left: 22px;
            }
            
            .label{
                font-size: 11pt;
                color: #002a5c;
                font-weight: bold;
                text-align: right;
                display: inline-block;
                width: 131px;
            }
            .val{
                font-size: 10pt;
                width: 60%;
            }
            
            .promoteUser{
                font-weight: bold;
            }
            .closeBtn{position: absolute;  top: 10px;  right:10px; z-index:1000; cursor:pointer;}
            #publicProjectNotice, .permitRead, .permitModify, .permitCopy, .permitButtons, .permitMetadata, .permitAdmin, .isMember, .mustBeAdmin{display:none;}
            #footer { width: 1010px; position: fixed;left:0;right:0; bottom:0;margin: 0 auto;}
            #foot { background: url(images/footer.png) top left no-repeat;position:relative;padding:50px 125px; }
            #button { text-decoration: none; }
            body,#wrapper {height: 100%;max-height: 100%;overflow: visible;}
            #project, #ms, #team, #options, #export { margin: 0; padding: 0;}
            #ms li, #export li, #team li{padding: 0.4em; padding-left: 1.5em; height: 100%;overflow: hidden; position: relative;margin-right: 1%; background: #BFBFBF; display: inline-table; color: #002a5c; border: none;}
            #project li ul,#ms li ul,#team li ul, #options li ul, #export li ul {padding: 0;margin: 0;}
            #project li ul li,#ms li ul li,#team li ul li,  #export li ul li {list-style:outside none;padding: 2px 0px 2px 4px;width:100%;height:100%;}
            #options li{
                padding: 0.4em; 
                padding-left: 1.5em; 
                max-height: 590px; 
                overflow-y: auto; 
                position: relative;
                margin-right: 1%; 
                width: 43%;
                border-right: 1px solid #BFBFBF;
                display: inline-block !important;
            }
            #project li{
                padding: 0.4em; 
                padding-left: 1.5em; 
                max-height: 590px; 
                overflow-y: auto; 
                position: relative;
                margin-right: 1%; 
                width: 43%;
                border-right: 1px solid #BFBFBF;
                display: inline-table !important;
            }
            #team li{padding: 0.4em; padding-left: 1.5em; height: 100%; width: 97%; overflow: hidden; position: relative;margin-right: 1%; background: #BFBFBF; color: #002a5c;}
            #project li{
                width: 43%;
            }
            
            #project div.tall {position: absolute;right:0;width: 29%;}
            #project div.tall li {position: absolute;right:20px;height:48%;margin:0;width:100%;min-height: 120px;}
            #project div.tall li:last-child {bottom:-13px;min-height: 80px;}
            #projectList {max-height: 300px;overflow-y:scroll; max-width: 95%;}
            #projectList li {    
                margin: 0;
                border: none;
                display: block;
            }
            a.tpenButton,button.tpenButton {padding: 2px 27px 2px 10px; margin:2px; display:block;text-align: center; text-decoration: none;min-width: 90px;min-height:16px; cursor:pointer; height: 35px; line-height: 35px;}
            .delete{   
                z-index: 1000;
                cursor: pointer;
                color: red;
                background-color: white;
                display: inline-block;
            }
            .stretch {font-size: 0.8em !important;}
            .shrink {width: 3em !important;font-size: 0.8em !important;}
            .grow {width:7em !important;}
            .bold, span.bold input {font-weight: bold; border: none;}
            span.bold input {width: 60px; font-size: .8em;}
            .ui-icon-closethick:hover {background-image: url(css/custom-theme/images/ui-icons_cd0a0a_256x240.png);}
            .disabled { margin: 0 3px 3px 23px; padding: 0.4em; padding-left: 1.5em; font-size: 1.4em; height: 18px;width:650px;}
            #addToProject,#addingTools {position: fixed; top:25%; left:25%; width:50%; display: none;z-index: 501;}
            #addingTools {
                box-shadow: 0 0 0 2000px rgba(0,0,0,.4);
                padding: 10px;
            }
            #addToolCommit, #addToolPreview {
                display: block;
                float: left;
            }
            #addToolName, #addToolURL {
                display: block;
                width: 50%;
            }
            #addToolFrame{
                float: right;
                height: 350px;
                width: 50%;
                position: relative;}
            #addToProject:after {
                content: "";
                width: 100%;
                height: 100%;
                position: fixed;
                pointer-events:none;
                z-index: 500;
                box-shadow: 0 0 200px black inset;
                top: 0;
                left: 0;}
            #form {height: 425px; margin: 0 auto; width:515px;border-width: 1px; 
                   -webkit-box-shadow: -1px -1px 12px black;
                   -moz-box-shadow: -1px -1px 12px black;
                   box-shadow: -1px -1px 12px black;
            }
            .delete {position:absolute;top:6px;right:6px;}
            input.text {width:100%;}
            #logFilter a:not(#openNote) {width:46%;float:left;margin-left: 1%;}
            #closePopup:hover {color: crimson;cursor: pointer;}
            .label {text-align: right; margin-right: 15px;}
            #inviteFeedback span {display:block;}
            #currentSetting {font-weight: bold;}
            #currentSetting:before {content:'Currently set to: "';color:black;font-weight: normal;}
            #currentSetting:after {content:'"';color:black;font-weight: normal;}
            .loadingBook {background-position: center center !important;}
            #xmlImport,#xmlValidate,#linebreaking,#wordbreak,#inviteUser,#template {margin:-4px 5px 2px;background: url(images/linen.png);padding:6px 2px 2px;display:none;overflow: hidden;z-index: 1; border: 1px solid #A68329;
                                                                                    -moz-box-shadow: -1px -1px 2px black;
                                                                                    -webkit-box-shadow: -1px -1px 2px black; 
                                                                                    box-shadow:-1px -1px 2px black;}
            #xmlImportBtn,#xmlValidateBtn,#linebreakingBtn,#wordbreakBtn,#inviteUserBtn,#templateBtn {padding:2px;text-align: center;position: relative;z-index: 1;cursor: pointer;width:100%;-o-box-sizing:border-box;-webkit-box-sizing:border-box;-moz-box-sizing:-ms-border-box;box-sizing:border-box;}
            #template label {width: 100%;}
            #template textarea {height: 3em;max-width: 100%;}
            .format{padding:2px;text-align: center;position: relative;z-index: 1;cursor: pointer;}
            .formatDiv{margin:-4px 5px 2px;clear:left;background: url(images/linen.png);padding:6px 2px 2px;display:none;overflow: hidden;z-index: 1; border: 1px solid #A68329;
                       -moz-box-shadow: -1px -1px 2px black;
                       -webkit-box-shadow: -1px -1px 2px black; 
                       box-shadow:-1px -1px 2px black;}
            #pdfOptions {display:block;}
            #exportLinebreakString,#exportWordbreak{width: 40px;}
            #quickExport span.choices {width:32%;float:left;position:relative;padding:15px 0;margin-bottom: -4px;}
            #quickExport {position:relative;}
            #quickExport input[type=radio] {visibility:visible;position: absolute;}
            .xmlRemove {display: none;clear: left;}
            .xmlShow {clear:left;}
            .xmlTags, .specialCharacters {display:block;}
            #quickExport h4 {position: relative;margin-bottom: 0;}
            .xmlFormat span {display: block;float:left;clear:left;width:40%;max-height: 18px;overflow: hidden;}
            #pageRange select {max-width: 175px;position: absolute;left:110px;}
            #exportTags select {position: absolute;right: 90px;}
            #samplePreview {overflow: hidden;position: relative;}
            #samplePreview img {width: auto;height: auto; position: absolute;left:0;top:30px;}
            #samplePreview h3 {position:relative;z-index: 1;}
            #samplePreview img, #samplePreview h3 {cursor: -moz-zoom-in, move;}
            #export label {font-weight: normal;width:auto;margin:0; padding:0;line-height: 24px; float: none;} /* override defaults */
            #export h3 {margin-top: 1em;margin-bottom: 0;}
            #export button {padding:8px 4px;width:33%;margin:0px;height:50px;}
            .xmlDisclaimer {display:none;float: left;clear: left;}
            #exportAlert {display: none;width:100%;}
            .partnerListing {width:100%;padding:2px;}
            .partnerName {width:100%;font-size: 125%;font-family: serif;display: block;}
            .partnerDescription {width:100%;padding:3px;margin:2px;display: block;white-space: normal;}
            .partnerSelected {background: green;}
            #QENI {overflow: auto;width: 100%;}
            #tpenSubmit,#disconnect {width:100%;margin-bottom: 1.25em;}
            #deleteConnection{display: none;}
            span + h4[id] {margin-top:1.25em;}
            .projectTools,.userTools {font-weight: normal;width: auto;padding: 0;clear: left;}
            #customHeader {margin: 1em;background-color: rgba(255,255,255,.5);padding: .5em;display: block;color: gray;border:thin solid gray;overflow: auto;text-overflow:ellipsis;max-height: 300px;font-size: smaller;}
            #projectOrdering {position: fixed !important;width:50% !important;right:auto !important;} /* battling weird Chrome bug */ 
            
        .tpenButton{
            color: white !important;
        }
        
        .tpenButton:hover{
            background-color: #D14836;
        }
        .pageCover{
                width: 100%;
                height: 2000px;
                z-index: 2;
                background-color: rgba(0,0,0,.7);
                position: absolute;
                top: -20px;
                display: none;
        }
        .projectTitle{
            margin-left: 22px;
            color: #002a5c;
        }
        .popHdr{
            border-bottom: 1px solid #002a5c;
            color: #002a5c;
        }
        .noBottom{
            margin-bottom: 3px;
        }
        
        #activeProjectName{
            text-decoration:underline;
        }
        
        #projectMembers li{
            border: none !important;
        }
        
        /* jQuery.css overwrites for the tab interface */
        .ui-tabs{
            padding: .2em .2em .2em 0em !important;
        }
        .ui-tabs .ui-tabs-nav {
            background: white !important;
            border: none !important;
            padding: 0px 0px 0px 2px !important;
        }
        
        .ui-tabs .ui-tabs-nav li{
            top: -3px !important;
            border-top: none !important;
            border-left: 1px solid #BFBFBF;
            border-right: 1px solid #BFBFBF; 
        }
        
        .ui-tabs .ui-tabs-nav li:hover{
            color: #e21635;
        }
        
        .ui-tabs .ui-tabs-nav li a{
            padding: 0 10px;
            display: block;
            float: left;
            height: 1.5em;
            line-height: 1.5em;
            margin-right: 1px;
            text-decoration: none;
            background-color: #f5f5f5;
            border-color: #ccc;
            font-size: 15px;
            font-weight: 300;
            cursor: pointer;
            transition: color 800ms;
        }
        
        .ui-tabs .ui-tabs-nav li.ui-tabs-selected a{
            background-color:white !important;
            color: black !important;
        }
        
        .ui-tabs .ui-tabs-nav li.ui-tabs-selected a:hover{
            border-color: #ccc;
            color: black !important;
            cursor: default;
        }
        
        .ui-tabs .ui-tabs-nav li a:hover, .ui-tabs .ui-tabs-nav li a:focus {
            background-color: #eee;
            border-color: #BFBFBF;
            color: #e21635;
        }
             
        
        .ui-state-default, .ui-widget-content, .ui-widget-header .ui-state-default{
            background: white !important;
        }
        
        .ui-tabs-panel{
            color: #002a5c !important;
            background: #BFBFBF !important;
        }
        
        #tabs{
            border-top: 1px solid #BFBFBF;
            border-left: none !important;
            border-right: none !important;
            border-bottom: none !important;
            margin: 0px 1%;
        }
        .ui-corner-bottom{
            background-color: white !important;
        }
        .topTabs ul li{
             color: #002a5c;
             //background-color: #D14836;
        }
        .ui-widget-content a {
             color: white;
        }
        .ui-tabs .ui-tabs-nav li a{
            color: #002a5c;
        }
        
        h3, h2{
            /*border-bottom: 1px solid #002a5c;*/
            border-bottom: 1px solid lightblue; /*their color under header*/
            /*border-bottom: 1px solid #ddd; /*their color separating sections*/
        }
        p{
            font-size: 12pt;
        }
        
/*        .ui-state-active a, .ui-state-active a:link{
            color: #002a5c !important;
        }*/
#site-name {
    margin: 0;
    padding: 0;
    font-size: 220%;
    font-weight: normal !important;
    font-family: 'EB Garamond', serif !important;
    text-align: center;
    box-sizing: border-box;
}

#logo{
    padding: 5px 1%;
    height: 100px;
}
#logo img{
    width: 50px;
    height: 65px;
}
.red{
    color: #b43d2e
}

#site-name a{
    color: black;
}
        
        
    </style>
    </head>
    <body>
        <h1 id="site-name">
            <a target="_blank" href="https://paleography.library.utoronto.ca/">French Renaissance 
              <div id="logo" style="display: inline-block;">
                  <img src="images/rp-logo.png">
              </div>
              <span class="red">Paleography</span> 
            </a>
        </h1>
        <div class='pageCover'></div>
        <input type="hidden" id="activeProjectID" />
        <div id="wrapper">
            <div id="content">
                <h1 class='projectTitle'>Project Management</h1>
                <div id="editProjectMetadata"></div>
                
                <div id="tabs">
                    <ul class="toptabs">
                        <li><a title="Organize your team" href="#tabs-3">Share</a></li>
                        <li><a title="Switch between projects" href="#tabs-1">Projects</a></li>
<!--                        <li><a title="Alter linebreaks and parsings" href="#tabs-2">Manuscripts</a></li>-->
                        <li><a title="Project Options" href="#tabs-4">Options</a></li>
<!--                        <li><a title="Export Options" href="#tabs-5">Export</a></li>-->
                    </ul>
                    <div id="tabs-1">
                        <ul id="project" class="ui-helper-reset">
                            <li class="ui-widget-content ui-corner-tr ui-corner-bl tall">
                                <h3>Project Selection</h3>
                                <p id="publicProjectNotice" class="ui-state-highlight">You are viewing public project, <span id="publicProjectName" class="loud bold">THIS PROJECT's NAME</span>. To manage one of your own projects, click below.</p>
                                
                                <p id="activeProject">Active project is <span id="activeProjectName" class="loud"></span>.</p>
                                <p> To manage a different project, click one below.</p>
                                <p>To delete a project click the 'x'.  You must be an administrator for the project.</p>
                                <h5>All Your Projects</h5>
                                <ul id="projectList">
                                    
                                </ul>
                            </li>
                            <li class="left ui-widget-content ui-corner-tr ui-corner-bl tall">
                                <h3>Current Metadata Summary</h3>                                    
                                <p style='max-width: 95%;'>
                                    <span class="label">Title: </span><span class="val metadataTitle"></span><br />
                                    <span class="label">Subtitle:</span> <span class="val metadataSubtitle"></span><br />
                                    <span class="label">MS&nbsp;Identifier:</span> <span class="val metadataMSID"></span><br />
                                    <span class="label">MS&nbsp;Settlement:</span> <span class="val metadataSettlement"></span><br />
                                    <span class="label">MS&nbsp;Repository: </span><span class="val metadataRepository"></span><br />
                                    <span class="label">MS&nbsp;Collection: </span><span class="val metadataCollection"></span><br />
                                    <span class="label">MS&nbsp;ID&nbsp;number: </span><span class="val metadataMSIDnum"></span><br />
                                    <!--<span class="label">Group&nbsp;Leader: </span><span class="val metadataLeader"></span>  GET group leader(s) -->
                                    <span class="label ">Subject:</span> <span class="val metadataSubject"></span><br>
                                    <span class="label ">Author:</span> <span class="val metadataAuthor"> </span><br>
                                    <span class="label ">Date:</span> <span class="val metadataDate" ></span><br>
                                    <span class="label ">Location:</span> <span class="val metadataLocation" ></span><br>
                                    <span class="label ">Language:</span> <span class="val metadataLanguage"></span><br>
                                    <span class="label ">Description:</span> <span class="val metadataDescription"></span><br>
                                </p>
                                
                                <div style='max-width: 95%;' class="permitMetadata isMember">
                                    <p class="mustBeAdmin">To update any of this information:</p>
                                    <a class="tpenButton mustBeAdmin" onclick="$('#projectMetadataWrapper').show(); $('.pageCover').show();"><span class="ui-icon ui-icon-tag right"></span>Update Metadata</a>
                                </div>
                         </li> 
                        </ul>
                    </div>
                    <div id="tabs-3">
                        <ul id="team" class="ui-helper-reset">
                            <li class="left ui-widget-content ui-corner-tr ui-corner-bl tall">
                                <div id="inviteFeedback"></div>
                                <a style="width: 200px;" class="tpenButton isMember" onclick="showTeamMemberManagement();"><span class="ui-icon ui-icon-person right"></span>Modify Project Team</a>
                                <p>Add, delete, or just check your group membership on this project.</p>
                                
                                <h3 class="noBottom">Project Members</h3>
                                <ul style="margin-left: 5px;" id="projectMembers" class="isMember">
                                    
                                </ul>
                               
                                <br />
                                <form id="inviteUser" class="ui-corner-all" name="invite" action="project.jsp" onsubmit="return simpleFormValidation();" method="get">
                                    <input type="hidden" name="projectID" value="PROJECTID">
                                    <input type="hidden" name="selecTab" value="2">
                                    <label for="uname">Email</label><input class="text" type="text" name="uname"/><br/>
                                    <label for="fname">First Name</label><input class="text" type="text" name="fname" /><br/>
                                    <label for="lname">Last Name</label><input class="text" type="text" name="lname"/><br/>
                                    <button type="submit" value="Register" name="invite" class="ui-button tpenButton"><span class="ui-icon ui-icon-person right"></span>Invite</button>
                                </form>
                            </li>
                        </ul>
                    </div>
                    <div id="tabs-4">
                        <ul id="options" class="ui-helper-reset">
                            <li class="left ui-widget-content ui-corner-tr ui-corner-bl tall permitModify isMember">
                                <div id="publicOptionsSelection" class="mustBeAdmin">
                                    <h2>Public Access Options</h2>
                                    <div id="publicOptionsForm">
                                        <input type="hidden" value="PROJECTID">
                                        <input type="hidden" value="2" name="selecTab" />
                                        <label for="OACr" class="publicLabel">
                                            <div class="publicDesc">
                                                <h4 class="noBottom">Open Annotation Collaboration</h4>
                                                <input id="OACr" name="OACr" type="checkbox" value="true" />OAC Read<br>
                                                <code>Read Permission</code>
                                                    <p>This setting allows external (not originating from t&#8209;pen.org) tools and services to <strong>read</strong> data from the T&#8209;PEN database. Projects with this permission can load annotations and transcriptions into other tools and interfaces for in-depth processing not available on T&#8209;PEN.</p>
                                                <span class="ui-state-error-text"><span class="left ui-icon ui-icon-unlocked"></span>This setting exposes your data <em>without authentication</em>.</span>
                                                <span class=""><span class="left ui-icon ui-icon-info"></span>Original project data cannot be changed with a <code>read</code> permission.</span>
                                                <span class=""><span class="left ui-icon ui-icon-notice"></span>Allowing this is not recommended unless you have a specific need in mind.</span>
                                            </div>
                                        </label>
                                        <label for="OACw" class="publicLabel">
                                            <div class="publicDesc">
                                                <h4 class="noBottom">Open Annotation Collaboration</h4>
                                                <input id="OACw" name="OACw" type="checkbox"  value="true" />OAC Write<br>
                                                    <code>Write Permission</code>
                                                    <p>This setting allows external (not originating from t&#8209;pen.org) tools and services to write data from the T&#8209;PEN database. Projects with this permission can load annotations and transcriptions into other tools <em>and changes saved</em> for in-depth processing not available on T&#8209;PEN.</p>
                                                <span class="ui-state-error-text"><span class="left ui-icon ui-icon-unlocked"></span>This setting exposes your data <em>without authentication</em>.</span>
                                                <span class="ui-state-error-text"><span class="left ui-icon ui-icon-alert"></span>Original project data can be changed with a <code>write</code> permission.</span>
                                                <span class=""><span class="left ui-icon ui-icon-notice"></span>Allowing this is not recommended unless you have a specific need in mind.</span>
                                            </div>
                                        </label>
                                        <label for="readTrans" class="publicLabel">
                                            <div class="publicDesc">
                                                <h4 class="noBottom">View Project</h4>
                                                <input id="readTrans" name="readTrans" type="checkbox"  value="true" />View Project<br>
                                                    <code>Read Permission</code>
                                                    <p>This setting allows users logged into T&#8209;PEN to <strong>view</strong> this project in the transcription interface. Users cannot make any changes or view any data not revealed in the interface.</p>
                                                <span class="ui-state-error-text"><span class="left ui-icon ui-icon-unlocked"></span>This setting does not track viewers and provides no protections against manual copying.</span>
                                                <span class=""><span class="left ui-icon ui-icon-info"></span>Original project data cannot be changed with a <code>read</code> permission.</span>
                                                <span class=""><span class="left ui-icon ui-icon-check"></span>This is the most restrictive way to make a project public.</span>
                                            </div>
                                        </label>
                                        <label for="publicExport" class="publicLabel">
                                            <div class="publicDesc">
                                                <h4 class="noBottom">Export Project</h4>
                                                <input id="publicExport" name="publicExport" type="checkbox"  value="true" />Export Project<br>
                                                    <code>Read Permission</code>
                                                    <p>This setting allows users logged into T&#8209;PEN to <strong>export</strong> this project through the T&#8209;PEN interface. Users cannot make any changes to original data.</p>
                                                <span class="ui-state-error-text"><span class="left ui-icon ui-icon-unlocked"></span>This setting does not track exports and provides no protections against copying.</span>
                                                <span class=""><span class="left ui-icon ui-icon-info"></span>Original project data cannot be changed with a <code>read</code> permission.</span>
                                                <span class=""><span class="left ui-icon ui-icon-notice"></span>Even without this permission, a clever and malicious user may capture data from any public project.</span>
                                            </div>
                                        </label>
                                        <label for="projectCopy" class="publicLabel">
                                            <div class="publicDesc">
                                                <h4 class="noBottom">Copy Project</h4>
                                                <input id="projectCopy" name="projectCopy" type="checkbox"  value="true" />Copy Project<br>
                                                    <code>Read Permission</code>
                                                    <p>This setting allows users logged into T&#8209;PEN to <strong>copy</strong> this project and work independently. Users cannot make any changes to original data.</p>
                                                <span class="ui-state-error-text"><span class="left ui-icon ui-icon-unlocked"></span>This setting does not track copies and does not prevent a user from making the copy more public than the original.</span>
                                                <span class=""><span class="left ui-icon ui-icon-info"></span>Original project data cannot be changed with a <code>read</code> permission.</span>
                                                <span class=""><span class="left ui-icon ui-icon-notice"></span>There is no way to merge or collate different branches of an original project.</span>
                                                <span class=""><span class="left ui-icon ui-icon-notice"></span>Projects containing private images cannot be copied.</span>
                                            </div>
                                        </label>
                                        <label for="modNotes" class="publicLabel">
                                            <div class="publicDesc">
                                                <h4 class="noBottom">Modify Notes</h4>
                                                <input id="modNotes" name="modNotes" type="checkbox"  value="true" />Modify Notes<br>
                                                    <code>Write Permission</code>
                                                    <p>This setting allows users logged into T&#8209;PEN to <strong>modify</strong> any data in the notes fields. Changes are not restricted, but are tracked in the History with a username and timestamp.</p>
                                                <span class="ui-state-error-text"><span class="left ui-icon ui-icon-alert"></span>Original project data can be changed with a <code>write</code> permission.</span>
                                                <span class=""><span class="left ui-icon ui-icon-info"></span>The transcription and notes fields are controlled by separate permissions.</span>
                                            </div>
                                        </label>
                                        <label for="modTrans" class="publicLabel">
                                            <div class="publicDesc">
                                                <h4 class="noBottom">Modify Transcription</h4>
                                                <input id="modTrans" name="modTrans" type="checkbox"  value="true" />Modify Transcription<br>
                                                    <code>Write Permission</code>
                                                    <p>This setting allows users logged into T&#8209;PEN to <strong>modify</strong> any data in the transcription fields. Changes are not restricted, but are tracked in the History with a username and timestamp.</p>
                                                <span class="ui-state-error-text"><span class="left ui-icon ui-icon-alert"></span>Original project data can be changed with a <code>write</code> permission.</span>
                                                <span class=""><span class="left ui-icon ui-icon-info"></span>The transcription and notes fields are controlled by separate permissions.</span>
                                            </div>
                                        </label>
                                        <label for="modAnno" class="publicLabel">
                                            <div class="publicDesc">
                                                <h4 class="noBottom">Modify Annotations</h4>
                                                <input id="modAnno" name="modAnno" type="checkbox"  value="true" />Modify Annotations<br>
                                                    <code>Write Permission</code>
                                                    <p>This setting allows users logged into T&#8209;PEN to <strong>modify</strong> any annotation. This includes insertion, deletion, and modification.</p>
                                                <span class="ui-state-error-text"><span class="left ui-icon ui-icon-alert"></span>Original project data can be changed with a <code>write</code> permission.</span>
                                                <span class=""><span class="left ui-icon ui-icon-info"></span>Only annotation modifications are allowed with this permission.</span>
                                            </div>
                                        </label>
                                        <label for="modParsing" class="publicLabel">
                                            <div class="publicDesc">
                                                <h4 class="noBottom">Modify Line Parsing</h4>
                                                <input id="modParsing" name="modParsing" type="checkbox"  value="true" />Modify Line Parsing<br>
                                                    <code>Write Permission</code>
                                                    <p>This setting allows users logged into T&#8209;PEN to <strong>modify</strong> line parsing. This includes insertion, deletion, and modification.</p>
                                                <span class="ui-state-error-text"><span class="left ui-icon ui-icon-alert"></span>Original project data can be changed with a <code>write</code> permission.</span>
                                                <span class="ui-state-error-text"><span class="left ui-icon ui-icon-alert"></span>If a user deletes a column which contains transcription data, the attached data will also be removed.</span>
                                            </div>
                                        </label>
                                        <label for="modButton" class="publicLabel">

                                            <div class="publicDesc">
                                                <h4 class="noBottom">Modify Buttons</h4>
                                                <input id="modButton" name="modButton" type="checkbox"  value="true" />Modify Buttons and Tags<br>
                                                    <code>Write Permission</code>
                                                    <p>This setting allows users logged into T&#8209;PEN to <strong>modify</strong> any special character or XML tag buttons in the project (including addition and deletion).</p>
                                                <span class="ui-state-error-text"><span class="left ui-icon ui-icon-alert"></span>Original project data can be changed with a <code>write</code> permission.</span>
                                                <span class=""><span class="left ui-icon ui-icon-notice"></span>Changes to buttons are not tracked in the project log.</span>
                                            </div>
                                        </label>
                                        <label for="modMetadata" class="publicLabel">
                                            <div class="publicDesc">
                                                <h4 class="noBottom">Modify Metadata</h4>
                                                <input id="modMetadata" name="modMetadata" type="checkbox"  value="true" />Modify Metadata<br>
                                                    <code>Write Permission</code>
                                                    <p>This setting allows users logged into T&#8209;PEN to <strong>modify</strong> project metadata or upload a custom header.</p>
                                                <span class="ui-state-error-text"><span class="left ui-icon ui-icon-alert"></span>Original project data can be changed with a <code>write</code> permission.</span>
                                                <span class=""><span class="left ui-icon ui-icon-notice"></span>Changes to metadata are not tracked in the project log.</span>
                                            </div>
                                        </label>
                                            <input style="display: inline-block;" type="reset" value="Clear All" onclick="$('.publicLabel').children('input').prop('checked',false);return false;" class="tpenButton ui-button" />    
                                            <input style="display: inline-block;" onclick="updatePublicOptions();" type="button" name="publicOptions" value="Submit Changes"  class="tpenButton ui-button" />    
                                    </div>
                                </div>
                            </li>
                            <li class="left ui-widget-content ui-corner-tr ui-corner-bl tall">
                               <div id="specChars">
                                   <h2>Custom Characters</h2>
                                    <div class="right" style="width:50%;">

                                        <div class="noBottom" id="characterReview"><h4 class="noBottom">Current Special Characters</h4>
                                            <p>Add a character by clicking 'Add A Character' and entering its numeric unicode value.  </p>
                                            <p>Rename by clicking on an entry below. Click the "X" icon to remove a button from the list.</p>
                                            <ul class="specialCharacters"></ul>
                                        </div>
                                    </div>
                                        <ul id="sortable1" class="connectedSortable ui-helper-reset">

                                    </ul>
                                    <input onclick="addnewcharcnfrm(event);" style="display: inline-block;" type="button" name="addH" class="tpenButton ui-button" value="Add a Character"/>
                                </div>
                                <div id="custXML">
                                    <div class="right" style="width:440px;">
                                        <h3>Custom XML Tags</h3>
                                        <p>Add a tag without &lsaquo;angle brackets&rsaquo; by clicking 'Add A Tag' below. </p>
                                        <p>Rename by clicking on an entry below. Click the "X" icon to remove a button from the list.</p>
                                        <div id="xmlReview"><h4 class="noBottom">Current Tags</h4>
                                            <ul class="xmlTags"></ul>
                                        </div>
                                    </div>
                                    <input onclick="addnewtagcnfrm(event);" style="display: inline-block;" type="button" name="addT" value="Add a Tag" class="tpenButton ui-button" onclick="document.getElementById('selecTab').value = 1;" />
                                    <br />
                                </div>
                            <input type="hidden" name="selecTab" id="selecTab" value="0"/>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div id="addingTools" class="ui-corner-all ui-widget ui-widget-content">
            <a id="closeAddingTools" href="#" onclick="$('#addingTools').fadeOut('normal');return false;" class="right tpenButton ui-button">Close<span class="ui-icon ui-icon-close right"></span></a>
            <h3>Add an iFrame Tool</h3>
        <!--                    <iframe src="iframe.html" id="addToolFrame"></iframe>-->
            <input id="addToolName" type="text" maxlength="25" placeholder="Tool Name" />
            <input id="addToolURL" type="text" placeholder="Full URL of tool" />
            <a class="tpenButton" id="addToolPreview" 
               onclick="$('#addToolFrame').attr('src',$('#addToolURL').val());">
                Test Link
            </a>
            <a class="tpenButton" id="addToolCommit"
               onclick="addProjectTool();">
                Add
            </a><br>
            <div id="addToolInfo" class="clear-left">
                <p>
                    Add a useful name and complete URL of the page you would like loaded as a tool.
                </p>
                <p>
                    Some pages will not allow themselves to be loaded into an iFrame, so you should test your tool before adding it.
                </p>
                <p>
                    These tools are connected to specific projects and will be available for all group members.
                </p>
            </div>
        </div>

        <div id="projectUserManagement">
            <div class="closeBtn" onclick="$('#projectUserManagement').hide(); $('.pageCover').hide();">X</div>
        </div>

        <div id="folioManagement">

        </div>

        <div id="buttonManagement">

        </div>
</body>
<script type="text/javascript">
    
var currentProjectID = 4351; 
$("#activeProjectID").val(currentProjectID);
var minWidth = 10;
var selecTab = null;
var currentUser = {uname:"", uid:-1};
var folioOrderedList = [];
var isMember=permitOACr=permitOACw=permitExport=permitCopy=permitModify=permitAnnotation=permitButtons=permitParsing=permitMetadata=permitNotes=permitRead=false;
var userIsProjectAdmin = false;
/* 
 * Get the required information to properly load the page, then run the functions to populate.  
 * You will need to get the projectID of the project being managed (either from the url variable or elsewhere, I am not sure how we enter this page yet.
 * You will need to know the username of the current logged in user and that user's userID. 
 * Once you have that, you can call the other API functions that give you the rest of the information you need throughout the functions on this page. 
 */
function getPreloadInformation(){
    //currentProjectID = 4352; However we know this when we get to this page, it is crucial that it get recorded;
    var url = "geti";
    var pageurl = document.location.href;
    var projectID = "";
    if(pageurl.indexOf("projectID=") === -1 || parseInt(pageurl.indexOf("?projectID="))+11 === pageurl.length){
        alert("you must provide a project ID");
        return false;
    }
    projectID = pageurl.substr(pageurl.indexOf("?projectID=")+11, pageurl.length -1);
    if(+projectID === parseInt(projectID)){
        //It is an integer, we can continue
    }
    else{
        alert("The id provided is not a number, so it is not a valid ID.  make sure there are no spaces, letters or punctuation marks in the ID.");
        return false;
    }
    $(".returnToTrans").attr("href","newberryTrans.html?projectID="+projectID);
    currentProjectID = parseInt(projectID);
    $("#activeProjectID").val(currentProjectID);
    $.ajax({
        url: url,
        type: "GET",
        dataType: "json",
        success: function(data){
            //console.log('CURRENT USER INFORMATION: ');
            //console.log(data);
            currentUser = data;
            if(data.uname && data.uname !== ""){
                loggedInUser = true;
                getActiveProjectMetadata(currentProjectID);
            }
            else{
                loggedInUser = false;
                alert("You must be logged in.");
            }
            
        },
        error: function(jqXHR,error, errorThrown) {  
            //probably just not logged in
                alert("The server could not tell me what user you are or you don't have permission to be on this page.");
        }
    });
}

function updatePublicOptions(){
    var url= "changeUserPermission";
    
    var params = {act:"cpm" , projectID:currentProjectID};
    $('#publicOptionsForm').find('input[type="checkbox"]').each(function(){
        var optionName = $(this).attr('name');
        switch(optionName){
            case "OACr":
                if($(this).is(':checked')){
                    params.allowOACRead = true;
                }
                else{
                    params.allowOACRead = false;
                }
                break;
            case "OACw":
                if($(this).is(':checked')){
                    params.allowOACWrite = true;
                }
                else{
                    params.allowOACWrite = false;
                }
                break;
            case "readTrans":
                if($(this).is(':checked')){
                   params.allowPublicReadTranscription = true;
                }
                else{
                   params.allowPublicReadTranscription = false;
                }
                break;
            case "publicExport":
                if($(this).is(':checked')){
                    params.allowExport = true;
                }
                else{
                    params.allowExport = false;
                }
                break;
            case "projectCopy":
                if($(this).is(':checked')){
                    params.allowPublicCopy = true;
                }
                else{
                    params.allowPublicCopy = false;
                }
                break;
            case "modNotes":
                if($(this).is(':checked')){
                    params.allowPublicModifyNotes = true;
                }
                else{
                    params.allowPublicModifyNotes = false;
                }
                break;
            case "modTrans":
                if($(this).is(':checked')){
                    params.allowPublicModifyTranscription = true;
                }
                else{
                    params.allowPublicModifyTranscription = false;
                }
                break;
            case "modAnno":
                if($(this).is(':checked')){
                    params.allowPublicModifyAnnotations = true;
                }
                else{
                    params.allowPublicModifyAnnotations = false;
                }
                break;
            case "modParsing":
                if($(this).is(':checked')){
                    params.allowPublicModifyLineParsing = true;
                }
                else{
                    params.allowPublicModifyLineParsing = false;
                }
                break;
            case "modButton":
                if($(this).is(':checked')){
                    params.allowPublicModifyButtons = true;
                }
                else{
                    params.allowPublicModifyButtons = true;
                }
                break;
            case "modMetadata":
                if($(this).is(':checked')){
                    params.allowPublicModifyMetadata = true;
                }
                else{
                    params.allowPublicModifyButtons = false;
                }
                break;
            default:
                alert('Unknown Project Option');
              
        }
    });
    $.post(url, params);
}

function showTeamMemberManagement(){
    if(userIsProjectAdmin){
        $('#projectUserManagement').show();
        $(".pageCover").show();
    }
    else{
        alert("You must be a project admin to alter the team.");
    }
}

function populateEditableXML(xmlTags){
    xmlTags = JSON.parse(xmlTags); // make a array by </span?
    var tagsInOrder = [];
    for (var tag = 0; tag < xmlTags.length; tag++){ 
        var newTagBtn = xmlTags[tag];
        if(newTagBtn.tag!=="" && newTagBtn.tag!==" "){
             tagsInOrder.push("<li class='projectTag' position='"+newTagBtn.position+"' onclick='editxmlcnfrm("+newTagBtn.position+", event);'>"+newTagBtn.tag+"\n\
                <span class='removechar' onclick=\"removetagcnfrm("+newTagBtn.position+");\">X</span></li>");
        }
    }
    $.each(tagsInOrder, function(){
        var button2 = $(''+this);
        $(".xmlTags").append(button2);
    }); 
}
    
function populateEditableChars(specialCharacters){
    specialCharacters = JSON.parse(specialCharacters);
    var speCharactersInOrder = new Array(specialCharacters.length);
    for (var char = 0; char < specialCharacters.length; char++){
            var thisChar = specialCharacters[char];
            if(thisChar == ""){

            }
            else{
                var keyVal = thisChar.key;
                var position2 = parseInt(thisChar.position);
                var newCharacter = $("<li position='"+position2+"' onclick='editcharcnfrm("+position2+", event);'  class='character'>&#"+keyVal+";<span class='removechar' onclick='removecharcnfrm("+position2+");'>X</span></li>");
                if(position2-1 >= 0 && (position2-1) < specialCharacters.length){
                    speCharactersInOrder[position2-1] = newCharacter; 
                }
            }

        }
        $.each(speCharactersInOrder, function(){
            var button1 = this;
            $(".specialCharacters").append(button1);
        });
    }
    
    function addnewcharcnfrm(event){
         var x = event.pageX;
         var y = event.pageY;
        $("<div class='optionCnfrm' id='newcharpopover'>\n\
            <p>Enter the numerical value for the special character you would like to add.</p>\n\
            <input type='text' id='newProjectChar' /><br>\n\
            <input type='button' value='Save Character' class='tpenButton' onclick='addnewchar();'/>\n\
            <input type='button' value='Cancel' class='tpenButton' onclick='$(this).parent().remove();'/>\n\
            </div>").appendTo("body").css("top",y).css("left",x);
    }
    
    function addnewtagcnfrm(event){
        var x = event.pageX;
        var y = event.pageY;
        $("<div class='optionCnfrm' id='newtagpopover'>\n\
            <p>Enter the word you would like this tag to be then enter a description for it (optional).</p>\n\
            <span>Tag: </span><input type='text' id='newProjectTag' /><br>\n\
            <span>Description:</span><input type='text' id='newProjectTagDescr' /><br>\n\
            <input type='button' value='Save Tag' class='tpenButton' onclick='addnewtag();'/>\n\
            <input type='button' value='Cancel' class='tpenButton' onclick='$(this).parent().remove();'/>\n\
            </div>").appendTo("body").css("top",y).css("left",x);
    }
    
    function addnewchar(){
        var code = $("#newProjectChar").val(); //move out of editcharcnfrm into DOM
        var position = parseInt($(".character:last").attr("position"))+1;
        var url = "saveNewProjectCharacter";
        var params = {"projectID":currentProjectID, "position":position, "code":code};
        $.post(url, params, function(data){
            var newBtn = $(data);
            $("#newcharpopover").remove();
            position -=1;
            $(".specialCharacters").children("li[position='"+position+"']").after(newBtn);
        });
    }
    
    function addnewtag(){
        var tag = $("#newProjectTag").val(); //move out of editcharcnfrm into DOM
        var description = $("#newProjectTagDescr").val(); //move out of editcharcnfrm into DOM
        var position = parseInt($(".projectTag:last").attr("position"))+1;
        var url = "saveNewProjectXML";
        var params = {"projectID":currentProjectID, "position":position, "tag":tag, "description":description};
        $.post(url, params, function(data){
            var newBtn = $(data);
            $("#newtagpopover").remove();
            position -=1;
            $(".xmlTags").children("li[position='"+position+"']").after(newBtn);
        });
    }
    
    function editcharcnfrm(position, event){
        if (event.target.tagName === "span") return false;
        var x = event.pageX;
        var y = event.pageY;
        $("<div class='optionCnfrm' id='editcharpopover'>\n\
            <p>Enter the word below that you would like this tag to be.</p>\n\
            <span>New Code: </span> <input type='text' id='newProjectChar' />\n\
            <input type='button' value='Update Character' class='tpenButton' onclick='editchar("+position+");'/>\n\
            <input type='button' value='Cancel' class='tpenButton' onclick='$(this).parent().remove();'/>\n\
            </div>").appendTo("body").css("top",y).css("left",x);
        
    }
    
    function removecharcnfrm(position){
        var cfrm = confirm("Click OK to delete this character from the project.");
        if(!cfrm)return false;
        else{
            removechar(position);
        }
    }
    
    function editxmlcnfrm(position, event){
        if (event.target.tagName === "span") return false;
        var x = event.pageX;
        var y = event.pageY;       
        $("<div class='optionCnfrm' id='editxmlpopover'>\n\
            <p>Enter the word below that you would like this tag to be.</p>\n\
            <span>New Tag: </span><input type='text' id='newProjectTag' />\n\
            <input type='button' value='Update Tag' class='tpenButton' onclick='editxml("+position+");'/>\n\
            <input type='button' value='Cancel' class='tpenButton' onclick='$(this).parent().remove();'/>\n\
            </div>").appendTo("body").css("top",y).css("left",x);
    }
    
    function removetagcnfrm(position){
        var cfrm = confirm("Click OK to delete this tag from the project.");
        if(!cfrm)return false;
        else{
            removetag(position);
        }
    }
    
    
    function editchar(position){
        var key = $("#newProjectChar").val(); //move out of editcharcnfrm into DOM
        var url = "updateProjectCharacter";
        var params = {"projectID":currentProjectID, "position":position, "key":key};
        $.post(url, params, function(data){
            $("#editcharpopover").remove();
            var newCharacter = $("<li position='"+position+"' onclick=\"editcharcnfrm('"+position+"', event);\"  class='character'>&#"+key+"; <span class='removechar' onclick=\"removecharcnfrm("+position+");\">X</span></li>");
            $(".specialCharacters").children("li[position='"+position+"']").replaceWith(newCharacter);
        });
    }
    
    function removechar(position){
        var url = "removeProjectCharacter";
        var params = {"projectID":currentProjectID, "position":position};
        $.post(url, params, function(data){
            $(".specialCharacters").children("li[position='"+position+"']").remove();
        });
    }
    
    function editxml(position){
        var tag = $("#newProjectTag").val(); //move out of editxmlcnfrm into DOM
        var url = "updateProjectTag";
        var params = {"projectID":currentProjectID, "position":position, "tag":tag};
        $.post(url, params, function(data){
            $("#editxmlpopover").remove();
            var newxml = $("<li class='projectTag' position='"+position+"' onclick=\"editxmlcnfrm("+position+", event);\">"+tag+"<span class='removechar' onclick=\"removetagcnfrm("+position+");\">X</span></li>");
            $(".xmlTags").children("li[position='"+position+"']").replaceWith(newxml);
        });
    }
    
    function removetag(position){
        var url = "removeProjectTag";
        var params = {"projectID":currentProjectID, "position":position};
        $.post(url, params, function(data){
            $(".xmlTags").children("li[position='"+position+"']").remove();
        });
    }

function getActiveProjectMetadata(currentProjectID){
    var isPublicProject = false;
    var addedUIDs = [];
    var leaderIDs = [];
    //console.log("GET METADATA");
    //Check if is public project and set this variable.
    var url = "getProjectTPENServlet?projectID="+currentProjectID;
    $.ajax({
        url: url,
        type:"GET",
        success: function(activeProject){
            //console.log("ACTIVE PROJECT INFORMATION");
            //console.log(activeProject);
            var leader = activeProject.ls_leader;
            leader = JSON.parse(leader);
            $.each(leader, function(){
                if(this.UID == currentUser.uid){ //check if current logged in user is an admin
                    userIsProjectAdmin = true;
                    leaderIDs.push(this.UID);
                    $('.mustBeAdmin').show();
                    $('.isMember').show();
                }
                if($.inArray(this.UID, addedUIDs) === -1){ //check if this user has already been added.
                    var leaderTag = " (Admin) ";
                    var removeUser = ""; //cannot remove admins from group, must demote first.
                    var promoteUser = ""; //admin is already promoted, no need for this.
                    var demoteUser = "";
                    if(!this.UID == currentUser.uid){ //if this is the current user, they shouldnt be able to demote themselves.  
                        demoteUser = "<a class='demoteUser' title='Demote this user' onclick='demoteUser("+this.UID+", $(this));' > - </a>";
                    }
                    $('#projectMembers').append("<li userID='"+this.UID+"'><span class='userFname'>"+this.fname+" </span><span class='userLname'>"+this.lname+"</span><span style='margin-left:5px;' class='userEmail'>("+this.Uname+")</span><span class='userFname'>"+leaderTag+"</span></li>");               
                    $('#editProjectMembers').append("<li>"+promoteUser+" "+demoteUser+"<span>" + this.Uname + leaderTag + "</span>"+removeUser+"</li>");
                    addedUIDs.push(this.UID);
                }
            });
            
            $('.metadataLeader').html(leader[0].fname +"&nbsp;"+leader[0].lname+"&nbsp;&nbsp;("+leader[0].Uname+")");
            var users = activeProject.ls_u;
            users=JSON.parse(users);
            $.each(users,function(){
                var leaderTag = "";
                var removeUser = "<a class='removeUser' onclick=\"removeUserFromProject('"+this.Uname+"', $(this).parent());\">Remove member</a>";
                var promoteUser = "<a class='promoteUser' title='Promote this user to Group Leader' onclick='promoteUserToAdmin("+this.UID+", $(this));' > + </a>";
                var demoteUser = "<a class='demoteUser' title='Demote this user' onclick='demoteUser("+this.UID+", $(this));' > - </a>";
                if($.inArray(this.UID, leaderIDs) !== -1){ //if a user is an admin
                        // leaders can demote others
                        removeUser = ""; //cannot remove admins from group
                        promoteUser = ""; //cannot promote admins
                        leaderTag = " (Admin) ";
                }
                else{ //user is not an admin
                    demoteUser = ""; //already demoted
                }
                if(this.UID == currentUser.uid){ //If current logged in user is a member of the project
                    isMember = true;
                    $('.isMember').show();
                    if(userIsProjectAdmin){ //The current user, and this user is an admin
                        //Can't do these things to yourself, it must be another admin that does them to you.  
                        removeUser = "";
                        promoteUser="";
                        demoteUser="";
                    }
                }
                if(!userIsProjectAdmin){ //if current user is not an admin, then they cannot perform the functions on anyone.
                    removeUser = "";
                    promoteUser="";
                    demoteUser="";
                }
                if($.inArray(this.UID, addedUIDs) === -1){ //check if this user has already been added.
                     $('#projectMembers').append("<li userID='"+this.UID+"'><span class='userFname'>"+this.fname+" </span><span class='userLname'>"+this.lname+"</span><span style='margin-left:5px;' class='userEmail'>("+this.Uname+")</span><span class='userFname'>"+leaderTag+"</span></li>");               
                     //reference groups.html to find this html element.
                     $('#editProjectMembers').append("<li>"+promoteUser+" "+demoteUser+"<span>" + this.Uname + leaderTag + "</span>"+removeUser+"</li>");
                     addedUIDs.push(this.UID);
                 }
            });  
            
            var publicProperties = activeProject.projper;
            publicProperties = JSON.parse(publicProperties);
            
            permitOACr = publicProperties.allow_OAC_read;
            permitOACw = publicProperties.allow_OAC_write;
            permitExport = publicProperties.allow_public_export;
            permitCopy = publicProperties.allow_public_copy;
            permitModify = publicProperties.allow_public_modify;
            permitAnnotation = publicProperties.allow_public_modify_annotation;
            permitButtons = publicProperties.allow_public_modify_buttons;
            permitParsing = publicProperties.allow_public_modify_lines_parsing;
            permitMetadata = publicProperties.allow_public_modify_metadata;
            permitNotes = publicProperties.allow_public_modify_notes;
            permitRead = publicProperties.allow_public_read_transcription;
            
            if(permitOACr){
                $('#OACr').attr('checked', 'checked');
            }
            if(permitOACr){
                $('#OACw').attr('checked', 'checked');
            }
            if(permitAnnotation){
                $('#modAnno').attr('checked', 'checked');
            }
            if(permitParsing){
                $('#modParsing').attr('checked', 'checked');
            }
            if(permitNotes){
                $('#modNotes').attr('checked', 'checked');
            }
            if(permitRead){
                $(".permitRead").show();
                $('#readTrans').attr('checked','checked');
            }
            if(permitModify){
                $(".permitModify").show();
                $('#modTrans').attr('checked', 'checked');
            }
            if(permitButtons){
                $(".permitButtons").show();
            }
            if(permitMetadata){
                $(".permitMetadata").show();
                $('#modMetadata').attr('checked', 'checked');
            }
            if(permitCopy){
                $(".permitCopy").show();
                $('#projectCopy').attr('checked','checked');
            }
            if(permitExport){
                $(".permitExport").show();
                $('#publicExport').attr('checked','checked');
            }
            
            var projectInformation = activeProject.metadata;
            projectInformation = JSON.parse(projectInformation);
            //console.log("get project information");
            //console.log(projectInformation);
            var projectTitle = projectInformation.title;
            var projectSubtitle = projectInformation.subtitle;
            var msIdentifier = projectInformation.msIdentifier;
            var msSettlement = projectInformation.msSettlement;
            var msRepository = projectInformation.msRepository;
            var msCollection = projectInformation.msCollection;
            var msIDNumber = projectInformation.msIdNumber;
            var author = projectInformation.author;
            var date = projectInformation.date;
            var location = projectInformation.location;
            var language = projectInformation.language;
            var description = projectInformation.description;
            var subject = projectInformation.subject;
            
            var specialCharacters = activeProject.projectButtons;
            var xmlTags = activeProject.xml;
            populateEditableXML(xmlTags);
            populateEditableChars(specialCharacters);
            
            //for all non-input areas
            $('.metadataTitle').html(projectTitle);
            $('#activeProjectName').html(projectTitle);
            $('.metadataSubtitle').html(projectSubtitle);
            $('.metadataMSID').html(msIdentifier);
            $('.metadataMSIDnum').html(msIDNumber);
            $('.metadataCollection').html(msCollection);
            $('.metadataSettlement').html(msSettlement)
            $('.metadataRepository').html(msRepository);
            $('.metadataSubject').html(subject);
            $('.metadataAuthor').html(author);
            $('.metadataDate').html(date);
            $('.metadataLocation').html(location);
            $('.metadataLanguage').html(language);
            $('.metadataDescription').html(description);
            
            //for all input areas.  
            $('.metadataTitle').val(projectTitle);
            $('#activeProjectName').val(projectTitle);
            $('.metadataSubtitle').val(projectSubtitle)
            $('.metadataMSID').val(msIdentifier);
            $('.metadataMSIDnum').val(msIDNumber);
            $('.metadataCollection').val(msCollection);
            $('.metadataSettlement').val(msSettlement)
            $('.metadataRepository').val(msRepository);
            $('.metadataSubject').val(subject);
            $('.metadataAuthor').val(author);
            $('.metadataDate').val(date);
            $('.metadataLocation').val(location);
            $('.metadataLanguage').val(language);
            $('.metadataDescription').val(description);
           
            //getPageName
            //getImageURL
            //getCollectionName
            //getFolioNumber
            var folioList = activeProject.ls_fs;
            folioList = JSON.parse(folioList);
            
            $.each(folioList, function(){
//                $("#manuscriptViewer").append("<li class='folios' title='"+folios[i].getCollectionName()+" "+folios[i].getPageName()+"'>\n\
//                <span class=\"clicked ui-icon ui-icon-arrowthick-1-e right\" title='Move a single image into the holding area'></span>\n\
//                <span class=\"discard ui-icon ui-icon-trash right\" title='Discard a single folio'></span><span class=\"imagePreview ui-icon left\" data-imgUrl="+folios[i].getImageURL() +"></span>\n\
//                <input type=\"hidden\" name=\"folio[]\" id=\""+folios[i].getFolioNumber()+"\" value=\""+folios[i].getFolioNumber()+"\"/>\n\
//                <span class='collection'>"+folios[i].getCollectionName()+"</span> <span class='pageName'>"+folios[i].getPageName()+"</span></li>")
            });
            
            var userToolList = activeProject.userTool;
            $.each(userToolList, function(){
                //Load these into the tool section for project editing
            });
            var projectToolList = activeProject.projectTool;
            projectToolList = JSON.parse(projectToolList);
            $.each(projectToolList, function(){
                //console.log("tool");
                //console.log(this);
                var toolLabel = this.name;
                var toolURL = this.url;
                var toolID = this.id;
                var projectTool = "<label class='projectTool'><input name='projectTool' type='checkbox' value='"+toolURL+"' title='"+toolLabel+"' toolName='"+toolLabel+"'/>"+toolLabel+"</label>";
                $("#projectTools").append(projectTool);
                //Load these into the tool section for project editing
            });
                     
            var projectManuscriptMetadata = activeProject.ls_ms;
            projectManuscriptMetadata = JSON.parse(projectManuscriptMetadata);
            //console.log("MANUSCRIPT METADATA");
            //console.log(projectManuscriptMetadata[0]);
            $('#linebreakNotice').html("Preview limited to first "+projectManuscriptMetadata[0].linebreakCharacterLimit+" characters.");            
            getUserProjects(currentProjectID, currentUser.uid, currentUser.uname);
        },
        error: function(jqXHR,error, errorThrown) {  
            //console.log("there was an error");
            if(jqXHR.status && jqXHR.status==400){
                 alert(jqXHR.responseText); 
            }
            else{
                alert("Could not retrieve project "+currentProjectID);
            }
       }
    });
        
}


function deleteProject(projID, elem){
    var url = "delProject";
    var params = {projectID:projID};
    $.post(url, params)
            .done(function(){
                $("#projectList").children("li[projectID='"+projID+"']").remove();
    });
}

function getUserProjects(projectID, userID, username){
    var url = "projects?username="+username;
    //How can I check if current user is the admin of the project? 
    var projectName = "";
    $.ajax({
        url: url,
        type:"GET",
        success: function(data){
            var userProjects = data;
            $.each(userProjects, function(){
                //the project name is properly decoded here.
                projectName = this.name;
                projectName=decodeURIComponent(projectName);
                var projectID = this.id;
                projectID = projectID.replace("projects/", "");
                //console.log('User is admin: '+userIsProjectAdmin)
                if(!userIsProjectAdmin){
                    $('#projectList').append("<li><a title=\"" + projectName + "\" class=\"tpenButton projectTitle\" href='project.html?projectID="+projectID+"'>"+projectName+"</a></li>");
                }
                else{
                    $('#projectList').append("<li projectID='"+projectID+"'>\n\
                    <a title=\"" + projectName + "\" class=\"tpenButton projectTitle\" href='project.html?projectID="+projectID+"'> "+projectName+" </a>\n\
                    <span style='z-index:1; cursor:pointer;' title=\"delete project\" class=\"delete ui-icon ui-icon-closethick right\" onclick=\"deleteProject("+projectID+");\"></span>\n\
                    </li>");
            //<span style='z-index:1000; cursor:pointer;' title=\"delete project\" class=\"delete ui-icon ui-icon-closethick right\" onclick=\"deleteProject();\"></span>
                }
            });
        },
        error: function(jqXHR,error, errorThrown) {  
            if(jqXHR.status && jqXHR.status==400){
                 alert(jqXHR.responseText); 
            }
            else if (jqXHR.status && jqXHR.status==404){
                alert("A project does not exist with this ID:"+projectID+".  Try with a different ID.");
            }
        }
    });
}

function modifyUserPermissions(act){
    var permissionString = "";
    var dataObject = {};
    var url = "changeUserPermission";
    if(act === "changerole"){
        var roleName = "";
        //Add role names based on UI here.
        dataObject.act = "changerole";
        dataObject.role = roleName;
    }
    $.post(url, dataObject);
}


function equalWidth(){
    $("#allXML").children("span").each(function(){
        minWidth = ($(this).width()>minWidth) ? $(this).width() : minWidth;
    }).css({"min-width":minWidth+"px"});
}
            
function equalHeights (eClass, minHeight){
    var minHeight = minHeight;
    var lis = $(".toptbas").children("li");
    var tabIndex = -1;
    var count = 0;
    $.each(lis, function(){
        count++;
        if($(this).attr("class").indexOf("ui-state-active") > -1){
            tabIndex = count;
            $("#tabs-"+tabIndex).find("."+eClass).each(function(){
                minHeight = ($(this).height()>minHeight) ? $(this).height() : minHeight; 
            });
            $("#tabs-"+tabIndex).find("."+eClass).css({"min-height":minHeight+"px"});
        }
    });
    
}

$(function() {
        $('#tabs').tabs({ 
            fx: { opacity: 'toggle', duration:250 },
            show: function(ui) {equalHeights("tall",100);equalWidth();}
        });
        getPreloadInformation();
        $('#editProjectMetadata').load("projectMetadata.html"); //include projectMetadata popover for editing metadata.
        $('#projectUserManagement').load("groups.html"); // include group management popover
        $('#folioManagement').load("projSequence.html");// include folio management popover
        $("#copyProjectBtn").click(function(){
            var cfrm = confirm('All transcriptions, parsings, and buttons will be copied into a new project.\n\nContinue?');
            return cfrm;
        });
        $("#xmlSelectAll").click(function(){
            if ($(this).attr('state') == "on"){
                $(this).text("Select All").attr('state','off');
                $("[name^='removeTag']").attr("checked",false);
            } else {
                $(this).text("Deselect All").attr('state','on');
                $("[name^='removeTag']").attr("checked",true);
            }
        });
        $("#export").find("button").hover(function(){$(this).toggleClass("ui-state-hover")});
        $( "#popupNote").click(function() {
            $( "#noteForm" ).fadeIn(1000);
            return false;
        });
        $( "#clearNote").click(function() {
            $( "#noteForm" ).fadeOut(500);
            return false;
        });
        
        if (selecTab) $('#tabs').tabs('option','selected',selecTab);
        $('span.delete').hover(
        function(){$(this).parent('li').find("a.tpenButton").addClass     ("ui-state-error strikeout");},
        function(){$(this).parent('li').find("a.tpenButton").removeClass  ("ui-state-error strikeout");}
    );
        $(".formatDiv").addClass('ui-corner-all');
        $(".format").click(function(){
            $(this).next("div.formatDiv").slideToggle(500);
        });
        $("#addManuscript").click(function(){
            $("#wrapper").append("<div class='ui-widget-overlay' id='overlay' style='display:none;'></div>");
            $("div#addToProject,#overlay").show('fade',500);
        });
        $("#closePopup").click(function(){
            $("div#addToProject,#overlay").hide('fade',500,function(){
                $("#overlay").remove();
            });
        });
        $("#xmlImportBtn,#inviteUserBtn,#templateBtn").click(function(){
            $(this).toggleClass("ui-state-active")
            .next("form").add("#QENIx").slideToggle(function(){
                equalHeights("tall",200);
            }); 
        });
        $("#xmlValidateBtn").click(function(){
            $("#xmlValidate").slideToggle(function(){
                equalHeights("tall",200);
            }); 
        });
        $("#linebreakingBtn").click(function(){
            $("#linebreaking").slideToggle(function(){
                equalHeights("tall",200);
            }); 
        });
        $("#wordbreakBtn").click(function(){
            $("#wordbreak").slideToggle(function(){
                equalHeights("tall",200);
            }); 
        });
//                                        $("#logFilter a").not($("#openNote")).hide(); //delete this line to enable the filters on the projectLog
        $("#logFilter a").not($("#openNote")).click(function(){
            $(this).toggleClass('ui-state-disabled');
            $("#projectLog div."+$(this).attr("filter")).parent().parent().slideToggle();
        });
        /* Handlers for Export Options */
        $("#inline, #pageonly").click(function(){
            if(this.checked) {
                $("#exportAlert").slideDown();
                $("#exportHyphenation").attr("disabled",false);
            }
            if($("#notesLine").attr("checked") || $("#notesSideBySide").attr("checked")){
                $("#notesRemove").attr("checked", true);
                //alert("Notes options were incompatable with this selection and have been changed.");
            }
            if(this.id=="inline") $("#notesFootnote").attr("disabled",true);
            $("#notesSideBySide, #notesLine").attr("disabled",true);
        });
        $("#newline").click(function(){
            if(this.checked) $("#exportHyphenation").attr("disabled",true);
            $("#notesSideBySide, #notesLine, #notesFootnote").attr("disabled",false);
        });
        $("#notesSideBySide,#notesLine").click(function(){
            if(this.checked) {
                $("#exportAlert").slideDown();
                $("#exportWordbreak, #pageonly, #inline").attr("disabled",true);
                if($("#pageonly").attr('#checked')||$("#inline").attr('checked')) {
                    //alert('Linebreaking options were incompatable with your selection and have been changed.');
                }
                $("#newline").attr({'checked': true,'disabled':false});
            }
        });
        $("#notesEndnote,#notesFootnote,#notesRemove").click(function(){
            if(this.checked) {
                $("#exportWordbreak, #newline, #exportLinebreakString, #useLinebreakString, #pageonly, #inline").attr("disabled",false);
                $("#exportAlert").slideUp();
            }
        });
        //                $("#metadataOption").click(function(){
        //                    if ($("#metadataSelect").is(":checked")) $("#metadataPreview").slideDown();
        //                    else $("#metadataPreview").slideUp();
        //                })
        $("#pdf,#rtf").click(function(){
            if(this.checked) {
                $(".xmlHide").show();
                $(".xmlDisclaimer").hide();
                $("#color").attr("disabled",false);
            }
        });
        $("#xml").click(function(){
            if(this.checked) {
                var areChanges = false;
                $(".xmlHide").hide();
                $(".xmlDisclaimer").show();
                $("#color").attr("disabled",true);
                if ($("#color").attr("checked")){
                    areChanges = true;
                    $("#bw").attr("checked",true);
                }
                if ($("#notesSideBySide,#notesEndnote,#notesFootnote,#notesLine").attr("checked")) {
                    areChanges = true;
                    $("#notesRemove").attr("checked",true);
                }
                if ($("#pageonly,#newline").attr("checked")) {
                    areChanges = true;
                }
                $("#inline").attr("checked",true);
                //if (areChanges) alert("Some selections are not supported in plaintext export and have been changed.");
            }
        });
        $(".beginFolio,.endFolio").change(function(){
            var thisIs = ($(this).hasClass('beginFolio')) ? "beginFolio" : "endFolio";
            $('.'+thisIs).val(this.value);
            var first = $(this).parent().find(".beginFolio");
            var last = $(this).parent().find(".endFolio");
            var firstFolio = first.children("option:selected").index();
            var lastFolio = last.children("option:selected").index();
            if (firstFolio > lastFolio) {
                first.add(last).addClass("ui-state-error").attr("title","Folio range does not include any pages.");
                $('#submitLimit').prop('disabled',true).addClass('ui-state-disabled');
            } else {
                first.add(last).removeClass("ui-state-error").attr("title","");
                $('#submitLimit').prop('disabled',false)
                    .removeClass('ui-state-disabled')
                    .html("Submit Set Range");
            }
        });

        $(".partnerListing").find("input:radio").click(function(event){
            event.preventDefault();
        });
        $("#QENI").find(".partnerListing").click(function(){
            $(this).find("input:radio").attr("checked",true);
            $("#QENI").scrollTop(0).find("input:checked")
            .parent(".partnerListing")
            .addClass("ui-state-active")
            .fadeOut(250,function(){
                $(this).css("opacity", 0)
                .prependTo("#QENI").slideDown()
                .animate({"opacity":1},250)
            })
            .siblings().removeClass("ui-state-active");
            if($("#QENI").parent("form").find("input[type='submit']").hasClass('hide')){
                $("#QENI").parent("form").find("input[type='submit']").slideDown().removeClass('hide');
            }
        });
        $("#disconnect").find(".partnerName").click(function(event){
            if(event.target != this){return true;}
            $("#tabs").tabs("select",4);
            setTimeout('$("#tpenSubmit").click()',350);
        })
        .find(".ui-icon-closethick").bind({
            mouseenter: function(){
                $("#deleteConnection").stop(true,true).slideDown();
                $("#disconnect").addClass("ui-state-error");
            },
            mouseleave: function(){
                $("#deleteConnection").stop(true,true).slideUp();
                $("#disconnect").removeClass("ui-state-error");
            },
            click: function(){
                $("#disconnect").find("input:radio").attr("checked",true);
                $("#QENI").find(".partnerListing").removeClass("ui-state-active")
                .parents("form").find("input[type='submit']").click();
            }
        })
        $("#template").find("input:text").keyup(function(){
            $("#template").find(".partnerName").html($(this).val());
        }).end()
        .find("textarea").keyup(function(){
            $("#template").find(".partnerDescription").html($(this).val());
        });
        $("#toolSelection").submit(function(){
            $(this).find(".projectTools").each(function(){
                var thisInput = $(this).find("input");
                thisInput.val($(this).find("span").text()+"TPENTOOLURL"+thisInput.val());
            });
        });
        $(".publicLabel").children('input').on('change',function(){$("#publicOptionResult").fadeOut('slow');});
        $("#samplePreview").hover(function(){
            $(this).find("img").css({
                "width" :   "auto",
                "height":   "auto"
            });
            var posX = $(this).offset().left;
            var posY = $(this).offset().top;
            var sampleX = $(this).width();
            var sampleY = $(this).height();
            var imgX = $(this).find("img").width();
            var imgY = $(this).find("img").height();
            var imgLeft = 0;
            var imgTop= 0;
            $(document).bind('mousemove', function(e){
                imgLeft = -(e.pageX-posX) * (imgX-sampleX-68) / sampleX;    // 68 pixel nudge for padding and box-model inconsistencies
                imgTop  = -(e.pageY-posY) * (imgY-sampleY-30) / sampleY;    // 30 pixel nudge for padding and box-model inconsistencies
                //alert("e.pageX:"+e.pageX+"\nposX:"+posX+"\nposY:"+posY+"\nsampleX:"+sampleX+"\nsampleY:"+sampleY+"\nimgLeft:"+imgLeft+"\nimgTop:"+imgTop);
                $("#samplePreview").find("img").css({
                    "left"  :   imgLeft,
                    "top"   :   imgTop
                });
//                        $("#samplePreview span").html(Math.round(e.pageY)+", "+Math.round(posY)+", "+Math.round(sampleY));
            });
        },function(){
            $(this).find("img").css({
                "width" :   "100%",
                "height":   "100%",
                "top"   :   "30px",
                "left"  :   0
            });
            $(document).unbind('mousemove');
        }).find("img").css({
            "width" :   "100%",
            "height":   "100%"
        });
        
//        $("#addT").click(function(){
//        var addTagData = {projectID:currentProjectID};
//        $.post("addTag", $.param(addTagData),function(data){
//            var position = data;    //tag position from servlet
//            $(".xmlTags").children("li").eq(-1).clone(true).html("New Tag").attr("position", position).appendTo($(".xmlTags"));
////            .children("input.description").attr("name", "description"+position).val("New Tag").end()
////                    .children("input.colors").attr("name","xmlColor"+position).val("black").end()
////            .children(".xmlParams").find("input").each(function(index,param){
////                var rename = (index > 0) ? "b"+position+"p"+index :  "b"+position;
////                $(param).attr("name", rename).val("");
////            });
//        },"html");           
//    });
//    
//    $("#addH").click(function(){
//        var addHotkeyData = {projectID:currentProjectID};
//        $.post("addHotkey", $.param(addHotkeyData),function(data){
//            var position = data;    //tag position from servlet
//            $("#sortable1").children("li").eq(-1).clone(true).appendTo($("#sortable1"))
//            .children("input.label").attr("id", "a"+position+"a").val("-").end()
//            .children("input.shrink").attr({
//                "name":"a"+position,
//                "id":"a"+position
//            }).val("42").end()
//            .children("a").attr("onclick","deleteHotkey("+position+");");
//        },"html");           
//    });
//    $( "#sortable1, #sortable2" ).sortable({
//        connectWith: ".connectedSortable",
//        placeholder: "ui-state-highlight ui-state-disabled",
//        axis:'y'
//    })
//    .css("cursor","move");
//    
//    $(".tag").children('input').change(function(){
//        unsavedAlert('#tabs-2');
//        isValidTag(this);
//    });
//    $(".moreParameters").click(function(){
//        $(this)
//            .hide()
//            .parent().next().slideDown();
//    });
//    $(".xmlPanel").focusin(function() {
//        $(".xmlPanel").not(this).each(function(){collapsePanel(this);});
//        expandPanel(this);
//    });
//    $('.toggleXML').click(function(){
//        if ($(this).hasClass("ui-icon-arrow-4")) {
//            expandPanel($(this).parent("li"));
//        } else {
//            collapsePanel($(this).parent("li"));
//        }
//    });
});

    function navigateTo(dropdown){
        $("body").addClass(" ui-state-disabled");
        document.location='transcription.jsp?p='+dropdown.value;
    }
    
    var selectWordbreak = "-";
    function customWordbreak(){
        selectWordbreak = $('#userWord').val();
        $("#currentSetting").html(selectWordbreak);
    }
    
    function scrubListings (){
        $("#listings").ajaxStop(function(){
            $("#listings a[href *= 'transcription']").hide();
        });
    }
    
    function addProjectTool() {
        var name=$("#addToolName").val();
        var URL=$("#addToolURL").val();
        if(name.length<1){
            $("#addToolName").addClass('ui-state-error').one('change',function(){$(this).removeClass('ui-state-error')});
            return false;
        }
        if(URL.length<5){
            $("#addToolURL").addClass('ui-state-error').one('change',function(){$(this).removeClass('ui-state-error')});
            return false;
        }
        var newTool = ['<label class="projectTool"><input type="checkbox" checked="true" value="',
                URL,'" title="',name,'"><span contenteditable="true">',name,'</span></label>'].join('');
            $(".projectTools").eq(0).before(newTool);
            $("#addingTools").fadeOut();
        var url = "addProjectToolServlet";
        var params = {"name":name, "projectID":4351, "url":URL };
        $.post(url, params);

    }
        
    function addUserTool(){
    
    }

    function removeProjectTool(){

    }

    function removeUserTool(){

    }
    
function expandPanel(btn) {
    $(btn)
        .find(".collapseXML").switchClass("collapseXML","expandXML").end()
        .find(".ui-icon-arrow-4").switchClass("ui-icon-arrow-4","ui-icon-arrowstop-1-n").end()
        .find(".xmlParams").slideDown();
}
function collapsePanel(btn) {
    $(btn)
        .find(".xmlParams").slideUp().end()
        .find(".expandXML").switchClass("expandXML","collapseXML").end()
        .find(".ui-icon-arrowstop-1-n").switchClass("ui-icon-arrowstop-1-n","ui-icon-arrow-4");
}
function unsavedAlert(idRef) {
    $("#tabs").find("a[href='"+idRef+"']").next().stop(true,true).show("pulsate","fast");
}
function deleteHotkey(position){
    $("#buttonForm")
        .append("<input type='hidden' value=true name='deletehotkey'/><input type='hidden' value="+position+" name='position'/>")
        .submit();
}
function deleteTag(position){
    $("#buttonForm")
        .append("<input type='hidden' value=true name='deletetag'/><input type='hidden' value="+position+" name='position'/>")
        .submit();
}
function rebuildOrder() {
        //interrupt saving if bad data is included
        if($(".badInfo").length > 0){
            var thisValue = $(".badInfo").val();
            alert("\""+thisValue+"\" is not valid unicode.\n\nPlease enter a number from 32-65518.");
            $(".badInfo").show('pulsate',500);
            return false;
        }
        var hotkeyLoop = $("#tabs-1").find("input:text").not(".label");
        var xmlLoop = $("#tabs-2").find("input:text");
        for (i=0;i<hotkeyLoop.length;i++){
            hotkeyLoop[i].name = "a"+(i+1);
        }
        for (i=0;i<xmlLoop.length;i=i+7) {
            xmlLoop[i].name = "description"+(i/7+1);
//            xmlLoop[i+1].name = "xmlColor"+(i/8+1);
            xmlLoop[i+1].name = "b"+(i/7+1);
            for (j=0;j<5;j++){                  //parameters
                xmlLoop[i+2+j].name = "b"+(i/7+1)+"p"+(j+1);
                if (xmlLoop[i+2+j].value == 'null') xmlLoop[i+2+j].value = '';
            }
        }
        return true;
    }
    
                              
</script>
</html>
